define(["exports"],function(t){"use strict";function e(t,...e){const r=null==(e=Object.assign({},...e)).notify?n():e.notify,{dispatchAction:i,defineAction:c}=function(n){let r;if(null!=e.dispatchAction){if("function"!=typeof(r=e.dispatchAction))throw new TypeError("Expected a dispatchAction(notify, actionName, actionArgs){â€¦} function")}else r="function"==typeof t.__dispatch__?function(e,n,o){return t.__dispatch__(e,n,o)}:o(t,e);return{dispatchAction:r,defineAction:e=>{"function"==typeof e?e=[[e.name,e]]:"string"==typeof e?e=[[e,t[e]]]:Array.isArray(e)?"string"==typeof e[0]&&(e=[e]):e=Object.entries(e);const o={},i={},c={};for(const[t,f]of e){if(!t)throw new TypeError("Action name not found");if("function"!=typeof f)throw new TypeError(`Expected action "${t}" to be a function, but found "${typeof f}"`);const e=function(...e){return r(n,t,e)};o[t]={value:f},i[t]={value:e},c[t]={value:e,configurable:!0}}Object.defineProperties(s,o),Object.defineProperties(a,i),Object.defineProperties(t,c)}}}(r);e.actions&&c(e.actions);const f={value:(...t)=>r.subscribe(...t)},s=Object.create(Object.getPrototypeOf(t),{subscribe:f}),a=Object.create(Object.getPrototypeOf(t),{subscribe:f});return Object.defineProperties(t,{subscribe:f,asAction:{set:c},__impl_proto__:{configurable:!0,value:s},__view_proto__:{configurable:!0,value:a}}),i(r,null,[],null),Object.freeze(Object.create(t))}function n(){function t(t){if(n!==t){n=t;for(const t of o)try{t(n)}catch(n){e(t)}}}function e(t){o=o.filter(e=>t!==e)}let n,o=[];return t.subscribe=function(...t){function r(){e(i)}const i=t.pop(),c=t[0];if(-1===o.indexOf(i)){if("function"!=typeof i)throw new TypeError("Please subscribe with a function");return o=o.concat([i]),c||i(n),r.unsubscribe=r,r}},t}function o(t,e={}){if(e.transform){const t=c(e.transform,"transform",e.transformFilter);e.after=[].concat(e.after||[],t)}if(e.viewTransform){const t=c(e.viewTransform,"viewTransform",e.viewTransformFilter);e.changed=[].concat(e.changed||[],t)}const n=e.isChanged||t.__is_changed__||i,o=r(e.before,t.__dispatch_before__,"before"),f=r(e.error,t.__dispatch_error__,"error"),s=r(e.after,t.__dispatch_after__,"after"),a=r(e.changed,t.__dispatch_changed__,"changed"),u=r(e.freeze,t.__dispatch_freeze__,"freeze");if(void 0!==n&&"function"!=typeof n)throw new TypeError("Dispatch expected 'isChanged' option to be a function instance");let p,_,l={};return function(e,r,i,c){const b=l,d=Object.create(t.__impl_proto__);Object.assign(d,l);let y;const h={action:[r,i,c],pre_state:b,isTipView:_===c&&void 0!==c};try{void 0!==o&&o(d,h);try{r?(y=d[r].apply(d,i),h.result=y):h.result=y=_=d,Object.setPrototypeOf(d,t.__view_proto__)}catch(e){if(Object.setPrototypeOf(d,t.__view_proto__),void 0===f)throw e;if(!1!==f(e,d,h))throw e}void 0!==s&&s(d,h);const e=Object.assign({},d);if(h.post_state=e,b!==l)throw new Error(`Async conflicting update of "${t.constructor.name}" occured`);const c=n(b,e,p,h);c?(h.changed=!0,l=e,p=c,_=d,void 0!==a&&a(d,h)):d===y&&(h.result=y=_)}finally{if(void 0!==u)try{u(d,h)}catch(t){Promise.reject(t)}Object.freeze(d)}return e(_),y}}function r(t,e,n){if(null!=e)t=[].concat(e,t||[]);else if(null==t)return;if("function"==typeof t)return t;if(Array.isArray(t)||t[Symbol.iterator]){const e=Array.from(t).filter(t=>null!=t);if(e.some(t=>"function"!=typeof t))throw new TypeError(`Dispatch expected '${n}' option to only include functions in list`);t=e.length<=1?e.pop():function(t,n,o){for(const r of e)try{r(t,n,o)}catch(t){Promise.reject(t)}}}if("function"!=typeof t)throw new TypeError(`Dispatch expected '${n}' option to be a function instance or list of functions`);return t}function i(t,e){if(void 0===t)return void 0!==e;for(const n of Object.keys(e))if(!(n in t))return!0;for(const n of Object.keys(t)){if(t[n]!==e[n])return!0;if(!(n in e))return!0}return!1}function c(t,e,n){if("function"!=typeof t)throw new TypeError(`Expected ${e}to be a function`);return n=(t=>!Object.isFrozen(t)),function(e){for(const o of Object.keys(e)){const r=e[o];n&&!n(r,o)||(e[o]=t(r))}}}t.ObjectFunctional=function(){return e(this)},t.asFunctionalObject=e,t.bindUpdateFunction=n,t.stateActionDispatch=o,t.asDispatchCallbackPipeline=r,t.isObjectChanged=i,t.bindStateTransform=c,Object.defineProperty(t,"__esModule",{value:!0})});
