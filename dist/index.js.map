{"version":3,"sources":["../code/index.jsy"],"names":["ObjectFunctional","asFunctionalObject","updateObservable","stateActionDispatch","asDispatchCallbackPipeline","isObjectChanged","bindStateTransform","host","options","Object","assign","notify","view_props","host_props","impl_props","Observable","_findUsableObservable","observable","from","subscribe","TypeError","bindObservable","defineAction","bindActionDeclarations","injectActions","name","keys","fnActionImpl","__impl_proto__","value","create","getPrototypeOf","__view_proto__","defineProperties","freeze","props","bind","Symbol","dispatchAction","__dispatch__","actionName","actionArgs","action","fnActionDispatch","defineProperty","configurable","asAction","set","addObserver","update","_observerColl","current","initial","next","observer","slice","err","removeObserver","error","push","idx","indexOf","splice","transform","xform","after","concat","viewTransform","changed","isChanged","__is_changed__","on_before","before","__dispatch_before__","on_error","__dispatch_error__","on_after","__dispatch_after__","on_changed","__dispatch_changed__","on_freeze","__dispatch_freeze__","undefined","initialState","initState","_init_state","state","state_summary","tip_view","view","change_summary","pre_state","tgt","result","ctx","isTipView","apply","setPrototypeOf","shouldThrow","post_state","Error","constructor","Promise","reject","callback","host_callback","callback_name","Array","isArray","iterator","callbackList","filter","e","some","cb","length","pop","arg1","arg2","prev","key","xform_name","window","global"],"mappings":"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","file":"index.js","sourcesContent":["export function ObjectFunctional() ::\n  return asFunctionalObject(this)\n\n// ---\n\nexport function asFunctionalObject(host, ...options) ::\n  :: // initialize options\n    options = Object.assign({}, ...options)\n\n    if null == options.notify ::\n      options.notify = updateObservable(options)\n\n\n  // setup notification, observable, and props\n  const notify = options.notify\n  const view_props = {} // properties for immutable views -- where actions are grafted on\n  const host_props = {} // properties to overlay on `host` paramter; uses immutable view actions dispatch\n  const impl_props = {} // properties for mutable clones -- where actions use specified implementation\n  ::\n    const Observable = _findUsableObservable(options)\n    const observable = Observable.from(notify.observable || notify)\n    if null == observable || 'function' !== typeof observable.subscribe ::\n      throw new TypeError @ `Notify option is expected to be ES Observable compatible`\n\n    bindObservable(observable)\n\n  // setup asAction setter hack -- in lieu of ES standard decorators\n  const defineAction = bindActionDeclarations @ notify\n  if options.injectActions ::\n    // allow injecting actions for time traveling debugging, etc.\n    for const name of Object.keys(options.injectActions) ::\n      const fnActionImpl = options.injectActions[name]\n      if 'function' !== typeof fnActionImpl ::\n        throw TypeError @ `Overlay action \"${name}\" expected as function, not \"${typeof fnActionImpl}\"`\n\n      defineAction({name}, fnActionImpl)\n\n\n  :: // view/impl prototype definitions and host prototype update \n    host_props.__impl_proto__ = @{} value() ::\n      return Object.create @ Object.getPrototypeOf(host), impl_props\n\n    host_props.__view_proto__ = @{} value() ::\n      return Object.create @ Object.getPrototypeOf(host), view_props\n\n    Object.defineProperties @ host, host_props\n\n\n  // return a frozen clone of the host object\n  return Object.freeze @ Object.create @ host\n\n\n  function bindObservable(observable) ::\n    for const props of [view_props, host_props, impl_props] ::\n      props.subscribe = @{} value: observable.subscribe.bind(observable)\n      props.observable = @{} value() :: return observable\n      if null != Symbol.observable ::\n        props[Symbol.observable] = props.observable\n\n  function bindActionDeclarations(notify) ::\n    let dispatchAction\n    if null != options.dispatchAction ::\n      dispatchAction = options.dispatchAction\n      if 'function' !== typeof dispatchAction ::\n        throw new TypeError(`Expected a dispatchAction(notify, actionName, actionArgs){…} function`)\n    else if 'function' === typeof host.__dispatch__ ::\n      dispatchAction = function(notify, actionName, actionArgs) ::\n        return host.__dispatch__(notify, actionName, actionArgs)\n    else ::\n      dispatchAction = stateActionDispatch(host, options)\n\n\n    const defineAction = (action, fnActionImpl) => ::\n      const actionName = action.name\n      const fnActionDispatch = function (...actionArgs) ::\n        return dispatchAction(notify, actionName, actionArgs, this)\n\n      impl_props[actionName] = @{} value: fnActionImpl || action\n      view_props[actionName] = @{} value: fnActionDispatch\n      Object.defineProperty @ host, actionName,\n        @{} configurable: true, value: fnActionDispatch\n\n    host_props.asAction = @{} set: defineAction\n    return defineAction\n\n\n// ---\n\nexport function updateObservable(options={}) ::\n  ::\n    const Observable = _findUsableObservable(options)\n    const observable = new Observable(addObserver)\n    update.observable = observable\n    if Symbol.observable ::\n      Object.defineProperty @ update, Symbol.observable,\n        @{} value() :: return observable\n\n\n  const _observerColl = []\n  let current = options.initial\n  return update\n\n  function update(next) ::\n    current = next\n    for const observer of _observerColl.slice() ::\n      try :: observer.next(current)\n      catch err ::\n        removeObserver(observer)\n        observer.error(err)\n\n  function addObserver(observer) ::\n    _observerColl.push(observer)\n    observer.next(current)\n    return () => :: removeObserver(observer)\n\n  function removeObserver(observer) ::\n    const idx = _observerColl.indexOf(observer)\n    if idx < 0 :: return false\n    _observerColl.splice(idx, 1)\n    return true\n\n\n// ---\n\n\nexport function stateActionDispatch(host, options={}) ::\n  if options.transform ::\n    const xform = bindStateTransform(options.transform, 'transform')\n    options.after = [].concat @ options.after || [], xform\n\n  if options.viewTransform ::\n    const xform = bindStateTransform(options.viewTransform, 'viewTransform')\n    options.changed = [].concat @ options.changed || [], xform\n\n  const isChanged = options.isChanged || host.__is_changed__ || isObjectChanged\n  const on_before = asDispatchCallbackPipeline @ options.before, host.__dispatch_before__, 'before'\n  const on_error = asDispatchCallbackPipeline @ options.error, host.__dispatch_error__, 'error'\n  const on_after = asDispatchCallbackPipeline @ options.after, host.__dispatch_after__, 'after'\n  const on_changed = asDispatchCallbackPipeline @ options.changed, host.__dispatch_changed__, 'changed'\n  const on_freeze = asDispatchCallbackPipeline @ options.freeze, host.__dispatch_freeze__, 'freeze'\n\n  if undefined !== isChanged && 'function' !== typeof isChanged ::\n    throw new TypeError @ `Dispatch expected 'isChanged' option to be a function instance`\n\n  let initialState = options.initialState\n  if 'function' !== typeof initialState ::\n    if 'function' === typeof host.initState ::\n      initialState = host => host.initState()\n    else ::\n      const _init_state = Object.assign @ {}, initialState\n      initialState = host => _init_state\n\n  let state = undefined, state_summary, tip_view\n  return __dispatch__\n\n  function __dispatch__(notify, actionName, actionArgs, view) ::\n    let change_summary\n    if undefined === state ::\n      state = initialState(host)\n      change_summary = true\n\n    const pre_state = state\n    const tgt = Object.create @ host.__impl_proto__()\n    Object.assign @ tgt, pre_state\n\n    let result\n    const ctx = @: action: [actionName, actionArgs, view]\n      , pre_state, isTipView: tip_view === view\n\n    try ::\n      if undefined !== on_before ::\n        on_before(tgt, ctx)\n\n      try ::\n        // dispatch action method\n        result = tgt[actionName].apply(tgt, actionArgs)\n        ctx.result = result\n        // transform from impl down to a view\n        Object.setPrototypeOf(tgt, host.__view_proto__())\n\n      catch err ::\n        // transform from impl down to a view\n        Object.setPrototypeOf(tgt, host.__view_proto__())\n\n        // handle error from action method\n        if undefined === on_error :: throw err\n\n        const shouldThrow = on_error(err, tgt, ctx)\n        if false !== shouldThrow :: throw err\n\n      if undefined !== on_after ::\n        on_after(tgt, ctx)\n\n      // capture state after dispatching action\n      const post_state = Object.assign @ {}, tgt\n      ctx.post_state = post_state\n\n      if pre_state !== state ::\n        throw new Error @ `Async conflicting update of \"${host.constructor.name}\" occured`\n\n      change_summary = isChanged(pre_state, post_state, state_summary, ctx)\n      ctx.changed = !! change_summary\n      if change_summary ::\n        state = post_state\n        state_summary = change_summary\n        tip_view = tgt\n\n        if undefined !== on_changed ::\n          on_changed(tgt, ctx)\n\n      else if tgt === result ::\n        ctx.result = result = tip_view\n\n    finally ::\n      if undefined !== on_freeze ::\n        try ::\n          on_freeze(tgt, ctx)\n        catch err ::\n          Promise.reject(err)\n      Object.freeze(tgt)\n\n    if change_summary :: notify @ tgt\n    return result\n\n// ---\n\nexport function asDispatchCallbackPipeline(callback, host_callback, callback_name) ::\n  if null != host_callback ::\n    callback = [].concat @ host_callback, callback || []\n  else if null == callback :: return\n\n  if 'function' === typeof callback :: return callback\n\n  if Array.isArray(callback) || callback[Symbol.iterator] ::\n    const callbackList = Array.from(callback).filter(e => null != e)\n\n    if callbackList.some @ cb => 'function' !== typeof cb ::\n      throw new TypeError @ `Dispatch expected '${callback_name}' option to only include functions in list`\n\n    if callbackList.length <= 1 ::\n      callback = callbackList.pop()\n    else ::\n      callback = function (tgt, arg1, arg2) ::\n        for const cb of callbackList ::\n          try :: cb(tgt, arg1, arg2)\n          catch err ::\n            Promise.reject(err)\n\n  if 'function' !== typeof callback ::\n    throw new TypeError @ `Dispatch expected '${callback_name}' option to be a function instance or list of functions`\n  return callback\n\n// ---\n\nexport function isObjectChanged(prev, next, state_summary, tgt) ::\n  for const key of Object.keys(next) ::\n    if ! @ key in prev ::\n      return true // added\n\n  for const key of Object.keys(prev) ::\n    if prev[key] !== next[key] ::\n      return true // changed\n    if ! @ key in next ::\n      return true // removed\n\n  return false\n\n// ---\n\nexport function bindStateTransform(xform, xform_name) ::\n  if 'function' !== typeof xform ::\n    throw new TypeError(`Expected ${xform_name}to be a function`)\n\n  return function(tgt) ::\n    for const key of Object.keys(tgt) ::\n      tgt[key] = xform @ tgt[key]\n\n// ---\n\nfunction _findUsableObservable(options) ::\n  if undefined !== options.Observable ::\n    return options.Observable\n  if undefined !== asFunctionalObject.Observable ::\n    return asFunctionalObject.Observable\n  if 'undefined' !== typeof window && undefined !== window.Observable ::\n    return window.Observable\n  if 'undefined' !== typeof global && undefined !== global.Observable ::\n    return global.Observable\n  throw new TypeError @ `Unable to locate an ES Observable implementation`\n"]}